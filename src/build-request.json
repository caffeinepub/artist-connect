{
  "kind": "build_request",
  "title": "Add music library with song uploads and enhanced bulk image upload with metadata",
  "projectName": "Artist Connect",
  "priority": "normal",
  "requirements": [
    {
      "id": "REQ-34",
      "text": "Create a Music data type in backend/main.mo with fields for title (Text), artist (Principal), audioFileBlob (Blob), price (Nat), description (Text), category (Text), uploadDate (Int), and unique ID",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-latest"
        ],
        "quotes": [
          "Artist can upload a song to the music library and sell a copy of the recording to anyone"
        ]
      },
      "acceptanceCriteria": [
        "Music type is defined in backend/main.mo with all required fields",
        "ID field uses unique identifier generation similar to existing Product and Gig types",
        "audioFileBlob field stores the uploaded audio file as a Blob"
      ]
    },
    {
      "id": "REQ-35",
      "text": "Add backend methods in main.mo for music management: createMusic (accepts audio blob, title, price, description, category), getAllMusic (returns all music items), getMusicById (returns single music item), updateMusic (modifies existing music), and deleteMusic (removes music item)",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-latest"
        ],
        "quotes": [
          "Artist can upload a song to the music library and sell a copy of the recording to anyone"
        ]
      },
      "acceptanceCriteria": [
        "createMusic method stores uploaded audio files and metadata",
        "getAllMusic returns array of all music items with filtering by artist",
        "getMusicById retrieves a single music item by ID",
        "updateMusic allows modification of music metadata",
        "deleteMusic removes music item and associated blob"
      ]
    },
    {
      "id": "REQ-36",
      "text": "Create MusicLibraryPage component at frontend/src/pages/MusicLibraryPage.tsx that displays all available music items in a grid layout with audio preview, title, artist name, price, and 'Add to Cart' button",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-latest"
        ],
        "quotes": [
          "Artist can upload a song to the music library and sell a copy of the recording to anyone"
        ]
      },
      "acceptanceCriteria": [
        "Page displays music items in a responsive grid",
        "Each music card shows title, artist, price, and description",
        "Audio preview player allows listening before purchase",
        "Add to Cart button adds music item to shopping cart"
      ]
    },
    {
      "id": "REQ-37",
      "text": "Add music upload dialog in MusicLibraryPage for authenticated artists to upload songs with fields for audio file selection, title, price, description, and category dropdown",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-latest"
        ],
        "quotes": [
          "Artist can upload a song to the music library and sell a copy of the recording to anyone"
        ]
      },
      "acceptanceCriteria": [
        "Dialog is accessible only to authenticated users",
        "File input accepts common audio formats (MP3, WAV, FLAC, AAC)",
        "Form includes required fields for title, price, description, and category",
        "Upload converts audio file to ExternalBlob format before submission",
        "Success toast notification appears after successful upload"
      ]
    },
    {
      "id": "REQ-38",
      "text": "Add route for music library page at /music in App.tsx router configuration",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-latest"
        ]
      },
      "acceptanceCriteria": [
        "Route /music renders MusicLibraryPage component",
        "Route follows existing routing patterns in App.tsx"
      ]
    },
    {
      "id": "REQ-39",
      "text": "Add 'Music Library' navigation link to Layout.tsx header that navigates to /music, positioned after 'Store'",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-latest"
        ]
      },
      "acceptanceCriteria": [
        "Navigation link appears in main header",
        "Link is visible to all users (authenticated and guest)",
        "Link is positioned after Store link in navigation"
      ]
    },
    {
      "id": "REQ-40",
      "text": "Create React Query hooks in useQueries.ts for music operations: useGetAllMusic, useGetMusicById, useCreateMusic, useUpdateMusic, and useDeleteMusic following established patterns",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-latest"
        ]
      },
      "acceptanceCriteria": [
        "All hooks follow React Query patterns used for products and gigs",
        "Mutation hooks invalidate music queries on success",
        "Hooks handle loading, error, and success states"
      ]
    },
    {
      "id": "REQ-41",
      "text": "Update cart functionality in useCart.ts to support music items with type 'music', tracking musicId, title, artist, and price",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-latest"
        ],
        "quotes": [
          "sell a copy of the recording to anyone"
        ]
      },
      "acceptanceCriteria": [
        "Cart state supports music items alongside products and gigs",
        "Music items display correctly in CartPage with audio icon",
        "Total calculation includes music item prices"
      ]
    },
    {
      "id": "REQ-42",
      "text": "Enhance BulkImageUpload component to include input fields for category dropdown, subcategory text input, price number input, and description textarea for each uploaded image",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-latest"
        ],
        "quotes": [
          "when uploading batch images create or add categorie and subcategorie, price and description"
        ]
      },
      "acceptanceCriteria": [
        "Each image preview shows editable fields for category, subcategory, price, and description",
        "Category dropdown is populated from backend product categories configuration",
        "Price field validates numeric input with minimum/maximum from store pricing rules",
        "Description field supports multi-line text input",
        "All metadata is submitted when creating products from bulk upload"
      ]
    },
    {
      "id": "REQ-43",
      "text": "Update bulk image upload logic in StorePage to pass category, subcategory, price, and description metadata from BulkImageUpload component to the backend createProduct method for each image",
      "target": "frontend",
      "source": {
        "messageIds": [
          "msg-latest"
        ],
        "quotes": [
          "when uploading batch images create or add categorie and subcategorie, price and description"
        ]
      },
      "acceptanceCriteria": [
        "Product creation includes all metadata fields from bulk upload form",
        "Each uploaded image creates a product with unique category, subcategory, price, and description",
        "Validation errors display per-image if required fields are missing",
        "Success feedback shows which products were created successfully"
      ]
    },
    {
      "id": "REQ-44",
      "text": "Add subcategory field (Text) to Product data type in backend/main.mo to store product subcategory classification",
      "target": "backend",
      "source": {
        "messageIds": [
          "msg-latest"
        ],
        "quotes": [
          "create or add categorie and subcategorie"
        ]
      },
      "acceptanceCriteria": [
        "Product type includes subcategory field",
        "createProduct and updateProduct methods accept subcategory parameter",
        "Subcategory is stored and retrieved with product data"
      ]
    }
  ],
  "constraints": [
    "Do not modify frontend/src/hooks/useInternetIdentity.ts or frontend/src/hooks/useActor.ts",
    "Do not edit UI component sources in frontend/src/components/ui",
    "Maintain single-actor architecture in backend/main.mo",
    "Follow existing patterns for Stripe checkout integration when selling music items",
    "Audio file validation must check for supported formats before upload",
    "Bulk upload metadata fields must use existing store configuration (categories, pricing rules) from AdminStoreSettingsPage"
  ],
  "nonGoals": [
    "Audio streaming or DRM protection for music files",
    "Advanced audio editing or mixing features",
    "Playlist creation or music player with queue management",
    "Social features like music sharing or comments",
    "Royalty tracking or split payments between multiple artists",
    "Automated audio format conversion",
    "Music discovery algorithms or recommendation engine"
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}